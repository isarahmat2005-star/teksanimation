<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Motion Engine Core</title>
    <style>
        /* DASHBOARD LAYOUT - BERSIH & FUNGSIONAL */
        body { font-family: sans-serif; background: #111; color: #eee; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar: Pusat Kontrol Fitur */
        .sidebar { width: 320px; background: #1a1a1a; padding: 20px; border-right: 1px solid #333; overflow-y: auto; display: flex; flex-direction: column; gap: 20px; }
        .group { border: 1px solid #333; padding: 15px; border-radius: 8px; background: #222; }
        .group-title { font-size: 12px; color: #888; text-transform: uppercase; margin-bottom: 10px; font-weight: bold; letter-spacing: 1px; }
        
        label { display: block; font-size: 13px; margin-bottom: 5px; color: #ccc; }
        input[type="text"], select, input[type="number"] {
            width: 100%; padding: 8px; background: #333; border: 1px solid #444; color: white; border-radius: 4px; box-sizing: border-box;
        }
        
        /* Main Area: Preview & Telemetry */
        .main { flex: 1; display: flex; flex-direction: column; padding: 20px; gap: 20px; background: #000; }
        
        .preview-box { 
            flex: 1; border: 1px dashed #444; display: flex; justify-content: center; align-items: center; 
            background-image: linear-gradient(45deg, #111 25%, transparent 25%), linear-gradient(-45deg, #111 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #111 75%), linear-gradient(-45deg, transparent 75%, #111 75%);
            background-size: 20px 20px; background-position: 0 0, 0 10px, 10px -10px, -10px 0px; /* Checkerboard pattern */
        }
        
        canvas { box-shadow: 0 0 20px rgba(0,0,0,0.8); max-width: 100%; max-height: 100%; }

        /* Console Log / Telemetry Real */
        .console-log { height: 150px; background: #0a0a0a; border: 1px solid #333; padding: 10px; font-family: monospace; font-size: 12px; overflow-y: auto; color: #0f0; }
        .log-entry { margin-bottom: 4px; border-bottom: 1px solid #111; padding-bottom: 2px; }
        .log-time { color: #666; margin-right: 10px; }

        button.primary { background: #007bff; color: white; border: none; padding: 12px; width: 100%; border-radius: 4px; font-weight: bold; cursor: pointer; }
        button.primary:hover { background: #0056b3; }
        button.primary:disabled { background: #444; cursor: not-allowed; }
    </style>
</head>
<body>

    <div class="sidebar">
        <h2 style="margin:0 0 10px 0;">Motion Engine</h2>
        
        <div class="group">
            <div class="group-title">Text Content</div>
            <label>Headline</label>
            <input type="text" id="inpText" value="MOTION APP">
            <label style="margin-top:10px">Sub-Headline</label>
            <input type="text" id="inpSub" value="FEATURE TEST">
        </div>

        <div class="group">
            <div class="group-title">Visual Engine</div>
            <label>Animation Style</label>
            <select id="selAnim">
                <option value="pulse">Pulse (Denyut)</option>
                <option value="shake">Shake (Gempa)</option>
                <option value="slide">Slide Up (Geser)</option>
            </select>
            
            <label style="margin-top:10px">Background Effect</label>
            <select id="selBg">
                <option value="solid">Solid Color</option>
                <option value="grid">Cyber Grid</option>
                <option value="particles">Floating Particles</option>
            </select>
        </div>

        <div class="group">
            <div class="group-title">Overlay Layer</div>
            <label>
                <input type="checkbox" id="chkScanline" checked> CRT Scanlines
            </label>
            <label>
                <input type="checkbox" id="chkVignette"> Dark Vignette
            </label>
        </div>

        <div class="group">
            <div class="group-title">Render Settings</div>
            <label>Resolution</label>
            <select id="selRes">
                <option value="1280,720">HD (1280x720)</option>
                <option value="1920,1080">FHD (1920x1080)</option>
            </select>
            <label style="margin-top:10px">FPS</label>
            <select id="selFps">
                <option value="30">30 FPS</option>
                <option value="60" selected>60 FPS</option>
            </select>
        </div>

        <button class="primary" onclick="app.startExport()">GENERATE VIDEO</button>
    </div>

    <div class="main">
        <div class="preview-box">
            <canvas id="stage"></canvas>
        </div>
        <div class="console-log" id="sysLog">
            <div class="log-entry"><span class="log-time">SYSTEM</span> Engine Initialized.</div>
        </div>
    </div>

    <script>
        // --- MODULE: TELEMETRY (LOG SISTEM) ---
        const Logger = {
            el: document.getElementById('sysLog'),
            info: function(msg) {
                const time = new Date().toLocaleTimeString();
                const div = document.createElement('div');
                div.className = 'log-entry';
                div.innerHTML = `<span class="log-time">[${time}]</span> ${msg}`;
                this.el.prepend(div);
            }
        };

        // --- MODULE: GRAPHICS ENGINE (CANVAS) ---
        const Graphics = {
            canvas: document.getElementById('stage'),
            ctx: document.getElementById('stage').getContext('2d'),
            width: 1280,
            height: 720,
            frame: 0,
            
            // State
            config: {
                text: "", sub: "", anim: "pulse", bg: "grid", 
                scanline: true, vignette: false
            },

            resize: function(w, h) {
                this.canvas.width = w;
                this.canvas.height = h;
                this.width = w;
                this.height = h;
                Logger.info(`Resolution changed to ${w}x${h}`);
            },

            // Fungsi Utama Render (Looping 60x per detik)
            render: function() {
                const ctx = this.ctx;
                const w = this.width;
                const h = this.height;
                const t = this.frame;

                // 1. CLEAR & BACKGROUND
                ctx.fillStyle = "#111";
                ctx.fillRect(0,0,w,h);

                // Fitur: Background Effect
                if(this.config.bg === 'grid') this.drawGrid(ctx, w, h, t);
                if(this.config.bg === 'particles') this.drawParticles(ctx, w, h, t);

                // 2. TEXT ANIMATION LOGIC
                ctx.textAlign = "center";
                ctx.textBaseline = "middle";
                let scale = 1;
                let offsetX = 0;
                let offsetY = 0;

                // Fitur: Animation Selector
                if(this.config.anim === 'pulse') {
                    scale = 1 + Math.sin(t * 0.05) * 0.05; // Membesar mengecil
                } else if(this.config.anim === 'shake') {
                    offsetX = (Math.random() - 0.5) * 10; // Getar kiri kanan
                    offsetY = (Math.random() - 0.5) * 10;
                } else if(this.config.anim === 'slide') {
                    // Reset posisi setiap 100 frame
                    let slideT = (t % 100) / 100; 
                    offsetY = 50 - (slideT * 50); // Geser dari bawah ke atas
                }

                ctx.save();
                ctx.translate(w/2 + offsetX, h/2 + offsetY);
                ctx.scale(scale, scale);

                // Draw Text 1
                ctx.font = `bold ${w*0.1}px Arial`;
                ctx.fillStyle = "#fff";
                ctx.shadowColor = "cyan";
                ctx.shadowBlur = 20;
                ctx.fillText(this.config.text, 0, -50);

                // Draw Text 2 (Sub)
                ctx.font = `${w*0.04}px Arial`;
                ctx.fillStyle = "#aaa";
                ctx.shadowBlur = 0;
                ctx.fillText(this.config.sub, 0, 80);

                ctx.restore();

                // 3. OVERLAY EFFECTS
                if(this.config.scanline) this.drawScanlines(ctx, w, h);
                if(this.config.vignette) this.drawVignette(ctx, w, h);

                this.frame++;
            },

            // Sub-Fitur: Grid
            drawGrid: function(ctx, w, h, t) {
                ctx.strokeStyle = "rgba(0, 255, 255, 0.2)";
                ctx.lineWidth = 1;
                const speed = (t * 2) % 50;
                // Vertical lines moving
                for(let x = 0; x < w; x+=50) {
                    ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, h); ctx.stroke();
                }
                // Horizontal lines (Horizon effect)
                for(let y = 0; y < h; y+=50) {
                    let yPos = y + speed; 
                    if(yPos > h) yPos -= h;
                    ctx.beginPath(); ctx.moveTo(0, yPos); ctx.lineTo(w, yPos); ctx.stroke();
                }
            },

            // Sub-Fitur: Particles
            drawParticles: function(ctx, w, h, t) {
                ctx.fillStyle = "rgba(255,255,255,0.5)";
                // Simulasi partikel sederhana (Deterministic random based on i)
                for(let i=0; i<50; i++) {
                    let x = (i * 153 + t) % w;
                    let y = (i * 87 + t * 0.5) % h;
                    ctx.beginPath(); ctx.arc(x, y, 3, 0, Math.PI*2); ctx.fill();
                }
            },

            // Sub-Fitur: Scanlines
            drawScanlines: function(ctx, w, h) {
                ctx.fillStyle = "rgba(0,0,0,0.3)";
                for(let y=0; y<h; y+=4) {
                    ctx.fillRect(0, y, w, 2);
                }
            },

            // Sub-Fitur: Vignette
            drawVignette: function(ctx, w, h) {
                const grad = ctx.createRadialGradient(w/2, h/2, h/3, w/2, h/2, h);
                grad.addColorStop(0, "transparent");
                grad.addColorStop(1, "rgba(0,0,0,0.8)");
                ctx.fillStyle = grad;
                ctx.fillRect(0,0,w,h);
            }
        };

        // --- MODULE: APPLICATION CONTROLLER ---
        const app = {
            timer: null,
            isRecording: false,

            init: function() {
                Logger.info("Loading Graphics Engine...");
                this.updateFromUI();
                
                // Event Listeners (Agar UI hidup)
                document.querySelectorAll('input, select').forEach(el => {
                    el.addEventListener('input', () => this.updateFromUI());
                });

                // Mulai Loop Animasi
                this.loop();
                Logger.info("Ready. Waiting for user command.");
            },

            updateFromUI: function() {
                // Ambil data dari Sidebar
                Graphics.config.text = document.getElementById('inpText').value;
                Graphics.config.sub = document.getElementById('inpSub').value;
                Graphics.config.anim = document.getElementById('selAnim').value;
                Graphics.config.bg = document.getElementById('selBg').value;
                Graphics.config.scanline = document.getElementById('chkScanline').checked;
                Graphics.config.vignette = document.getElementById('chkVignette').checked;

                // Cek Resolusi
                const res = document.getElementById('selRes').value.split(',');
                if(Graphics.width != res[0]) {
                    Graphics.resize(parseInt(res[0]), parseInt(res[1]));
                }
            },

            loop: function() {
                Graphics.render();
                requestAnimationFrame(() => this.loop());
            },

            // Fitur: Export Video Logic
            startExport: function() {
                if(this.isRecording) return;
                this.isRecording = true;
                
                const fps = parseInt(document.getElementById('selFps').value);
                Logger.info(`Starting Capture at ${fps} FPS...`);
                
                // Setup MediaRecorder
                const stream = Graphics.canvas.captureStream(fps);
                const recorder = new MediaRecorder(stream, { mimeType: 'video/webm' });
                const chunks = [];

                recorder.ondataavailable = e => chunks.push(e.data);
                recorder.onstop = () => {
                    const blob = new Blob(chunks, { type: 'video/webm' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `render_${Date.now()}.webm`;
                    a.click();
                    Logger.info("Download started.");
                    this.isRecording = false;
                    document.querySelector('button.primary').innerText = "GENERATE VIDEO";
                    document.querySelector('button.primary').disabled = false;
                };

                // Rekam selama 3 detik
                recorder.start();
                document.querySelector('button.primary').innerText = "RECORDING (3s)...";
                document.querySelector('button.primary').disabled = true;

                setTimeout(() => {
                    Logger.info("Finishing encoding...");
                    recorder.stop();
                }, 3000);
            }
        };

        // Jalankan Aplikasi
        app.init();

    </script>
</body>
</html>
